<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; media-src *; img-src 'self' data: content:; script-src 'self' https://www.gstatic.com 'unsafe-inline' 'unsafe-eval'; connect-src 'self' https://*.firebaseio.com wss://*.firebaseio.com;">

    <title>ब्रह्मविद्या</title>
    
    <script src="filelist.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        /* जुनीच स्टाईल (काही बदल नाही) */
        :root { --glass: rgba(255,255,255,0.2); --text: #000; }
        body.dark-mode { --glass: rgba(0,0,0,0.6); --text: #fff; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; height: 100vh; overflow: hidden; color: var(--text); background: #333; transition: 0.5s; user-select: none; }
        body.state-login { background-image: url('login_bg.png'); background-size: cover; }
        #login-screen, #library-screen { position: absolute; width: 100%; height: 100%; }
        #library-screen { display: none; }
        .glass-card { background: rgba(255,255,255,0.9); padding: 25px; border-radius: 20px; text-align: center; width: 80%; margin: 50% auto; }
        input { padding: 10px; width: 90%; margin: 10px 0; font-size: 18px; }
        .btn { padding: 10px; width: 100%; background: black; color: white; border: none; font-size: 16px; }
    </style>
</head>
<body class="state-login">

    <div id="login-screen">
        <div class="glass-card">
            <h2>ब्रह्मविद्या</h2>
            <p id="debug-msg" style="color:red; font-size:12px;">App Starting...</p>
            
            <input type="tel" id="pin" placeholder="PIN टाका" maxlength="8">
            <button class="btn" onclick="performLogin()">प्रवेश करा</button>
        </div>
    </div>

    <div id="library-screen">
        <h2 style="text-align:center; color:white; margin-top:50px;">ग्रंथालय</h2>
        <div id="book-container" style="padding:20px; color:white;"></div>
    </div>

    <script>
        // --- DEBUGGING START ---
        // ॲप चालू झाले की लगेच हा अलर्ट येईल
        alert("App Started! Checking Firebase...");

        var db;
        var deviceId = localStorage.getItem('did') || 'USER_' + Math.floor(Math.random()*10000);
        localStorage.setItem('did', deviceId);

        // --- FIREBASE SETUP ---
        var firebaseConfig = { 
            databaseURL: "https://brahmvidya-app-default-rtdb.asia-southeast1.firebasedatabase.app/" // <--- इथे तुमची खरी URL टाका!!
        }; 

        try { 
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
            
            // Firebase कनेक्ट झाले का ते चेक करण्यासाठी
            db.ref('.info/connected').on('value', function(snap) {
                if (snap.val() === true) {
                    document.getElementById('debug-msg').innerText = "Status: Connected ✅";
                    document.getElementById('debug-msg').style.color = "green";
                } else {
                    document.getElementById('debug-msg').innerText = "Status: Offline ❌";
                }
            });
            
        } catch(e) { 
            alert("Firebase Error: " + e.message);
            document.getElementById('debug-msg').innerText = "Error: " + e.message;
        }

        // --- LOGIN LOGIC ---
        function performLogin() {
            var pin = document.getElementById('pin').value;
            if(pin === "92252320") {
                alert("Login Success! ID: " + deviceId);
                
                // 1. Firebase वर नाव पाठवा (Admin साठी)
                if(navigator.onLine) {
                    db.ref('users/' + deviceId).update({ 
                        last_login: new Date().toISOString(),
                        device_name: "Android Device"
                    }).then(() => {
                        alert("Data sent to Admin Panel!");
                    }).catch(err => {
                        alert("Send Error: " + err.message);
                    });
                }
                
                // 2. स्क्रीन बदला
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('library-screen').style.display = 'block';
                
            } else {
                alert("Wrong PIN");
            }
        }
    </script>
</body>
</html>
