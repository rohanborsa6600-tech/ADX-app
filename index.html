<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; media-src *; img-src 'self' data: content:; script-src 'self' https://www.gstatic.com 'unsafe-inline' 'unsafe-eval'; connect-src 'self' https://*.firebaseio.com https://*.firebasedatabase.app wss://*.firebaseio.com wss://*.firebasedatabase.app;">

    <title>‡§¨‡•ç‡§∞‡§π‡•ç‡§Æ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ ‡§ï‡§≤‡•ç‡§™‡§¶‡•ç‡§∞‡•Ç‡§Æ</title>
    
    <script src="filelist.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        body { margin: 0; font-family: sans-serif; height: 100vh; background: #222; color: white; overflow: hidden; }
        #login-screen, #library-screen { position: absolute; width: 100%; height: 100%; }
        #library-screen { display: none; }
        
        .glass-card { 
            background: rgba(255,255,255,0.1); backdrop-filter: blur(10px);
            padding: 20px; border-radius: 15px; text-align: center;
            width: 80%; position: absolute; top: 50%; left: 50%; 
            transform: translate(-50%, -50%); border: 1px solid rgba(255,255,255,0.2);
        }
        input { padding: 10px; width: 90%; margin: 10px 0; border-radius: 5px; border: none; text-align: center; }
        button { padding: 10px; width: 100%; background: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }
        .footer { position: absolute; bottom: 10px; width: 100%; text-align: center; font-size: 12px; opacity: 0.7; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="glass-card">
            <h2>‡§¨‡•ç‡§∞‡§π‡•ç‡§Æ‡§µ‡§ø‡§¶‡•ç‡§Ø‡§æ ‡§ï‡§≤‡•ç‡§™‡§¶‡•ç‡§∞‡•Ç‡§Æ</h2>
            <p id="status" style="font-size:10px; color:lightgreen;">Connecting...</p>
            <input type="tel" id="pin" placeholder="PIN ‡§ü‡§æ‡§ï‡§æ" maxlength="8">
            <button onclick="login()">‡§™‡•ç‡§∞‡§µ‡•á‡§∂ ‡§ï‡§∞‡§æ</button>
        </div>
        <div class="footer">|| ‡§∂‡•ç‡§∞‡•Ä ‡§¶‡•á‡§µ‡§¶‡§§‡•ç‡§§ ‡§Ü‡§∂‡•ç‡§∞‡§Æ, ‡§ú‡§æ‡§ß‡§µ‡§µ‡§æ‡§°‡•Ä ||</div>
    </div>

    <div id="library-screen">
        <h2 style="text-align:center; margin-top:50px;">‡§ó‡•ç‡§∞‡§Ç‡§•‡§æ‡§≤‡§Ø</h2>
        <div id="book-list" style="padding:20px;"></div>
    </div>

    <script>
        // --- ‡§§‡•Å‡§Æ‡§ö‡•Ä ‡§®‡§µ‡•Ä‡§® ‡§≤‡§ø‡§Ç‡§ï (adx-bk) ---
        var firebaseConfig = { 
            databaseURL: "https://adx-bk-default-rtdb.asia-southeast1.firebasedatabase.app"
        };
        
        try {
            firebase.initializeApp(firebaseConfig);
            var db = firebase.database();
            document.getElementById('status').innerText = "Ready";
        } catch(e) {
            alert("Firebase Error: " + e.message);
        }
        
        var deviceId = localStorage.getItem('did') || 'USER_' + Math.floor(Math.random()*10000);
        localStorage.setItem('did', deviceId);

        function login() {
            var pin = document.getElementById('pin').value;
            if(pin === "92252320") {
                document.getElementById('status').innerText = "Logging in...";
                
                // Admin ‡§≤‡§æ ‡§ï‡§≥‡§µ‡§æ
                if(navigator.onLine) {
                    db.ref('users/' + deviceId).update({
                        last_login: new Date().toISOString(),
                        device_name: "Android User"
                    });
                    
                    if(typeof autoBookList !== 'undefined') {
                        db.ref('library_catalog').set(autoBookList);
                    }
                }
                
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('library-screen').style.display = 'block';
                loadBooks();
            } else {
                alert("Wrong PIN");
            }
        }

        function loadBooks() {
            var container = document.getElementById('book-list');
            container.innerHTML = "<p style='text-align:center'>‡§≤‡•ã‡§° ‡§π‡•ã‡§§ ‡§Ü‡§π‡•á...</p>";
            
            db.ref('users/' + deviceId + '/access').on('value', snap => {
                var access = snap.val() || {};
                container.innerHTML = "";
                
                if(typeof autoBookList !== 'undefined') {
                    autoBookList.forEach(book => {
                        if(access[book.name]) {
                            var div = document.createElement('div');
                            div.innerHTML = `<h3>üìñ ${book.name}</h3>`;
                            container.appendChild(div);
                        }
                    });
                }
                if(container.innerHTML === "") container.innerHTML = "<p style='text-align:center'>‡§Ö‡§ú‡•Ç‡§® ‡§™‡§∞‡§Æ‡§ø‡§∂‡§® ‡§®‡§æ‡§π‡•Ä.</p>";
            });
        }
    </script>
</body>
</html>
